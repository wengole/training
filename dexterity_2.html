

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>23. Dexterity Types II: Growing up &mdash; Mastering Plone 1.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
    <link rel="top" title="Mastering Plone 1.2 documentation" href="index.html"/>
        <link rel="next" title="24. Custom search" href="custom_search.html"/>
        <link rel="prev" title="22. IDEâ€™s and Editors" href="ide.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Mastering Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-we">Who are we?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">Who are you?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">What will we do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">What will we not do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">What to expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation &amp; Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Installing Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Hosting Plone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Installing Plone for the Training</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Install VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Install and configure Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">What Vagrant does</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">4. The Case-Study</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">5. The Anatomy of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. The Features of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Starting and Stopping Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configure a Mailserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walktrough-of-the-ui">Walktrough of the UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Content-Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Content Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Manage members and groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Working copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Placeful workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configuring and Customizing Plone through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">The Control Panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extending Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Extension technologies</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">What are components, what is ZCML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extend Plone with Add-ons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-addons">How to find addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-noteable-addons">Some noteable addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-addons">Installing Addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Add Photogallery with collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalisation">Internationalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">11. Buildout I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">A real life example</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">Hello mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Be McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">12. Creating your own eggs to customize Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">13. Dexterity I: Through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">What is a content-type?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity and Archetypes - A Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modifying existing types</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creating content-types TTW</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moving content-types into code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">A simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL and TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL and macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accessing Plone from the template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">What we missed</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Customizing existing templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Finding the right template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">skin-templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views II: A default view for &#8220;talk&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">View-Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">The default-view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views III: A Talk list</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#using-portal-catalog">Using portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#brains-and-objects">brains and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#querying-the-catalog">Querying the catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#the-template-for-the-listing">The template for the listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#setting-a-custom-view-as-default-view-on-an-object">Setting a custom view as default-view on an object</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#adding-some-javascript-collective-js-datatables">Adding some javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="behaviors1.html">19. Behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#dexterity-approach">Dexterity Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#names-and-theory">Names and Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#practical-example">Practical example</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#adding-it-to-our-talk">Adding it to our talk</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_1.html">20. Writing Viewlets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#a-viewlet-for-the-social-behavior">A viewlet for the social behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#social-viewlet">social-viewlet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">21. Programming Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#plone-api">plone.api</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#portal-tools">portal-tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">22. IDE&#8217;s and Editors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">23. Dexterity Types II: Growing up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add-a-marker-interface-to-the-talk-type">Add a marker-interface to the talk-type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-steps">Upgrade-steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-browserlayer">Add a browserlayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-catalog-indexes">Add catalog-indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-for-custom-indexes">Query for custom indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-collection-criteria">Add collection criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-more-features-through-generic-setup">Add more features through generic-setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom_search.html">24. Custom search</a><ul>
<li class="toctree-l2"><a class="reference internal" href="custom_search.html#eea-facetednavigation">eea.facetednavigation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">25. Turn talks into events</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_generated_content.html">26. User generated content</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#self-registration">Self-registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#a-custom-workflow-for-talks">A custom workflow for talks</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#grant-local-roles">Grant local roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#move-the-changes-to-the-file-system">Move the changes to the file-system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ressources.html">27. Ressources</a></li>
<li class="toctree-l1"><a class="reference internal" href="thirdparty_behaviors.html">28. Using third-party behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thirdparty_behaviors.html#add-teaser-with-collective-behavior-banner">Add teaser with collective.behavior.banner</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_3.html">29. Dexterity Types III: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs2.html">30. Creating reusable packages with eggs</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviors2.html">31. More complex behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-annotations">Using Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-schema">Using Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#writing-code">Writing Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_2.html">32. A viewlet for the voteable behavior</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#voting-viewlet">Voting Viewlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-the-viewlet-code">Writing the Viewlet code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-template">The template</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-javascript-code">The javascript code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-2-simple-view-helpers">Writing 2 simple view helpers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reusable.html">33. Making our package reusable</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#adding-permissions">Adding permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#using-our-permissions">Using our permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#provide-defaults">Provide defaults</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="embed.html">34. Using starzel.votable_behavior in ploneconf.site</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_sites.html">35. Buildout II: Getting ready for deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#the-starzel-buildout">The starzel-buildout</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#a-deployment-setup">A deployment-setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#other-tools-we-use">Other tools we use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="future_of_plone.html">36. The Future of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional.html">37. Optional</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Mastering Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>23. Dexterity Types II: Growing up</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="dexterity-types-ii-growing-up">
<h1>23. Dexterity Types II: Growing up<a class="headerlink" href="#dexterity-types-ii-growing-up" title="Permalink to this headline">Â¶</a></h1>
<p>The existing talks are still lacking some functionality we want to use.</p>
<p>In this part we will:</p>
<ul class="simple">
<li><em>pythonify</em> our talk-type a little more</li>
<li>create custom catalog-indexes</li>
<li>query the catalog for them</li>
<li>enable some more default-features for our type</li>
</ul>
<div class="section" id="add-a-marker-interface-to-the-talk-type">
<h2>Add a marker-interface to the talk-type<a class="headerlink" href="#add-a-marker-interface-to-the-talk-type" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="marker-interfaces">
<h3>Marker Interfaces<a class="headerlink" href="#marker-interfaces" title="Permalink to this headline">Â¶</a></h3>
<p>The content-type <cite>Talk</cite> is not yet a first-class citizen because it does not implement his own interface. Interfaces are like name-tags, telling other elements who and what you are and what you can do. A marker interface is like such a nametag. The talks actually have a auto-generated marker-interface <tt class="docutils literal"><span class="pre">plone.dexterity.schema.generated.Plone_0_talk</span></tt>.</p>
<p>The problem is that the name of the Plone-instance <tt class="docutils literal"><span class="pre">Plone</span></tt> is part of that interface-name. If you now moved these types to a site with another name, code that uses these Interfaces would no longer find the objects in question.</p>
<p>For this we add a new file <tt class="docutils literal"><span class="pre">Ã¬nterfaces.py</span></tt>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>


<span class="k">class</span> <span class="nc">ITalk</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker interface for Talks</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">ITalk</span></tt> is a marker-interface. We can bind Views and Viewlets to content that provide these interfaces. Now we talks to provide this Interface. There are two solution for this.</p>
<ol class="arabic simple">
<li>Let them be instances of a class that implements this Interface.</li>
<li>Register this interface as a behavior and enable it on talks.</li>
</ol>
<p>The first option has a important drawback: Only new talks would be instances of the new class. We would either have to migrate the existing talks or delete them.</p>
<p>We register the interface as a behavior in <tt class="docutils literal"><span class="pre">behaviors/configure.zcml</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;plone:behavior</span>
  <span class="na">title=</span><span class="s">&quot;Talk&quot;</span>
  <span class="na">description=</span><span class="s">&quot;Marker interface for talks to be able to bind views to.&quot;</span>
  <span class="na">provides=</span><span class="s">&quot;..interfaces.ITalk&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>And enable it on the type in <tt class="docutils literal"><span class="pre">profiles/default/types/talk.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IDublinCore&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;ploneconf.site.behaviors.social.ISocial&quot;</span><span class="nt">/&gt;</span>
<span class="hll"> <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Either reinstall the addon, apply the behavior by hand or run a upgrade-step (see below) and the interface will be there.</p>
<p>Then we can safely bind the talkview to the new marker interface.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
  <span class="na">name=</span><span class="s">&quot;talklistview&quot;</span>
<span class="hll">  <span class="na">for=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span>
</span>  <span class="na">layer=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
  <span class="na">class=</span><span class="s">&quot;.views.TalkListView&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/talklistview.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Now the <tt class="docutils literal"><span class="pre">/talkview</span></tt> can only be used on objects that implement said interface. We can now also query the catalog for objects providing this interface <tt class="docutils literal"><span class="pre">catalog(object_provides=&quot;ploneconf.site.interfaces.ITalk&quot;)</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Just for completeness sake, this is what would have to happen for the first option:</p>
<ul class="last">
<li><p class="first">Create a new class that inherits from <tt class="docutils literal"><span class="pre">plone.dexterity.content.Container</span></tt> and implements the marker interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.dexterity.content</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">ploneconf.site.interfaces</span> <span class="kn">import</span> <span class="n">ITalk</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span>

<span class="k">class</span> <span class="nc">Talk</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">ITalk</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Modify the class for new talks in <tt class="docutils literal"><span class="pre">profiles/default/types/talk.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>...
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_permission&quot;</span><span class="nt">&gt;</span>cmf.AddPortalContent<span class="nt">&lt;/property&gt;</span>
<span class="hll"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;klass&quot;</span><span class="nt">&gt;</span>ploneconf.site.content.talk.Talk<span class="nt">&lt;/property&gt;</span>
</span><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
...
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Create a upgrade step to modify the class of existing types. A code-example on how to do this is in <a class="reference external" href="https://github.com/4teamwork/ftw.upgrade/blob/master/ftw/upgrade/step.py#L270">ftw.upgrade</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="upgrade-steps">
<h2>Upgrade-steps<a class="headerlink" href="#upgrade-steps" title="Permalink to this headline">Â¶</a></h2>
<p>When projects evolve you&#8217;ll sometimes have to modify various things while the site is already up and brimming with content and users. Upgrade steps are pieces of code that run when upgrading from one version of a addon to a newer one. They can do just about anything.</p>
<p>We will create a upgrade step that</p>
<ul class="simple">
<li>runs the typeinfo-step (i.e. loads the GenericSetup configuration stores in <tt class="docutils literal"><span class="pre">profiles/default/types.xml</span></tt> and <tt class="docutils literal"><span class="pre">profiles/default/types/...</span></tt> so we don&#8217;t have to reinstall the addon to have our changes from above take effect) and</li>
<li>cleans up some content that might be scattered around the site in the early stages of creating it. We will move all talks to a folder <tt class="docutils literal"><span class="pre">talks</span></tt> (unless they already are there) and also move all</li>
</ul>
<p>Upgrade steps are usually registered in their own zcml-file. Create <tt class="docutils literal"><span class="pre">upgrades.zcml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:i18n=</span><span class="s">&quot;http://namespaces.zope.org/i18n&quot;</span>
  <span class="na">xmlns:genericsetup=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span>
  <span class="na">i18n_domain=</span><span class="s">&quot;ploneconf.site&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;genericsetup:upgradeStep</span>
    <span class="na">title=</span><span class="s">&quot;Modifiy class of talks&quot;</span>
    <span class="na">description=</span><span class="s">&quot;Change the class of talks from &#39;plone.dexterity.content.Container&#39; to &#39;ploneconf.site.content.talk.Talk&#39;&quot;</span>
    <span class="na">source=</span><span class="s">&quot;1&quot;</span>
    <span class="na">destination=</span><span class="s">&quot;1001&quot;</span>
    <span class="na">handler=</span><span class="s">&quot;ploneconf.site.upgrades.upgrade_site&quot;</span>
    <span class="na">sortkey=</span><span class="s">&quot;1&quot;</span>
    <span class="na">profile=</span><span class="s">&quot;ploneconf.site:default&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>The upgrade step bumps the verion-number of the GenericSetup profile of ploneconf.site from 1 to 1001. The version is stored in <tt class="docutils literal"><span class="pre">profiles/default/metadata.xml</span></tt>. Change it to</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;version&gt;</span>1001<span class="nt">&lt;/version&gt;</span>
</pre></div>
</div>
<p>Include the new <tt class="docutils literal"><span class="pre">upgrades.zcml</span></tt> in our <tt class="docutils literal"><span class="pre">configure.zcml</span></tt> by adding:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;upgrades.zcml&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>GenericSetup now expects the code to be a method <tt class="docutils literal"><span class="pre">upgrade_talks</span></tt> in the file <tt class="docutils literal"><span class="pre">upgrades.py</span></tt>. Let&#8217;s create it.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">default_profile</span> <span class="o">=</span> <span class="s">&#39;profile-ploneconf.site:default&#39;</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;ploneconf.site&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">upgrade_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">default_profile</span><span class="p">,</span> <span class="s">&#39;typeinfo&#39;</span><span class="p">)</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="n">portal</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">&#39;talks&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">portal</span><span class="p">:</span>
        <span class="n">talks</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">portal</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s">&#39;Folder&#39;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s">&#39;talks&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Talks&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">talks</span> <span class="o">=</span> <span class="n">portal</span><span class="p">[</span><span class="s">&#39;talks&#39;</span><span class="p">]</span>
    <span class="n">talks_url</span> <span class="o">=</span> <span class="n">talks</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()</span>
    <span class="n">brains</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;talk&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">talks_url</span> <span class="ow">in</span> <span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Moving </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">())</span>
        <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">talks</span><span class="p">,</span>
            <span class="n">safe_id</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>After restarting the site we can run the step:</p>
<ul class="simple">
<li>Go to the addon-controlpanel <a class="reference external" href="http://localhost:8080/Plone/prefs_install_products_form">http://localhost:8080/Plone/prefs_install_products_form</a>. There should now be a warning <strong>This add-on has been upgraded. Old profile version was 1. New profile version is 1001</strong> and a button next to it.</li>
<li>Run the upgrade-step by clicking on it.</li>
</ul>
<p>On the console you should see logging-messages like:</p>
<div class="highlight-python"><div class="highlight"><pre>INFO ploneconf.site Moving http://localhost:8080/Plone/old-talk1
</pre></div>
</div>
<p>Alternatively you can select which upgrade-steps to run like this:</p>
<ul class="simple">
<li>In the ZMI got to <em>portal_setup</em></li>
<li>Go to the tab <em>Upgrades</em></li>
<li>Select <em>ploneconf.site</em> from the dropdown and click <em>Choose profile</em></li>
<li>Run the upgrade step.</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/addons/components/genericsetup.html#id1">http://docs.plone.org/develop/addons/components/genericsetup.html#id1</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Upgrading from an older version of Plone to a newer one also runs upgrade steps from the package <tt class="docutils literal"><span class="pre">plone.app.upgrade</span></tt>. You should be able to upgrade a clean site from 2.5 to 5.0a2 with a click.</p>
<p class="last">For an example see the upgrade-step to Plone 5.0a1 <a class="reference external" href="https://github.com/plone/plone.app.upgrade/blob/master/plone/app/upgrade/v50/alphas.py#L23">https://github.com/plone/plone.app.upgrade/blob/master/plone/app/upgrade/v50/alphas.py#L23</a></p>
</div>
</div>
<div class="section" id="add-a-browserlayer">
<h2>Add a browserlayer<a class="headerlink" href="#add-a-browserlayer" title="Permalink to this headline">Â¶</a></h2>
<p>A browserlayer is another such marker-interface. Browserlayers allow us to easily enable and disable views and other site functionality based on installed add-ons and themes.</p>
<p>Since we want the features we write only to be available when ploneconf.site actually is installed we can bind them to a browserlayer.</p>
<p>In <tt class="docutils literal"><span class="pre">interfaces.py</span></tt> we add:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IPloneconfSiteLayer</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker interface for the Browserlayer</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>We register the browserlayer in GenericSetup in <tt class="docutils literal"><span class="pre">profiles/default/browserlayer.xml</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;layers&gt;</span>
  <span class="nt">&lt;layer</span> <span class="na">name=</span><span class="s">&quot;ploneconf.site&quot;</span>
    <span class="na">interface=</span><span class="s">&quot;ploneconf.site.interfaces.IPloneconfSiteLayer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/layers&gt;</span>
</pre></div>
</div>
<p>After reinstalling the addon we can bind the talkview, the demoview and the talklistview to our layer. Here is an example using the talkview.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
  <span class="na">name=</span><span class="s">&quot;talklistview&quot;</span>
  <span class="na">for=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span>
<span class="hll">  <span class="na">layer=</span><span class="s">&quot;..interfaces.IPloneconfSiteLayer&quot;</span>
</span>  <span class="na">class=</span><span class="s">&quot;.views.TalkListView&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/talklistview.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Note the relative python-path <tt class="docutils literal"><span class="pre">..interfaces.IPloneconfSiteLayer</span></tt>. It is equivalent to the absolute path <tt class="docutils literal"><span class="pre">ploneconf.site.interfaces.IPloneconfSiteLayer</span></tt>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/views/layers.html">http://docs.plone.org/develop/plone/views/layers.html</a></p>
</div>
</div>
<div class="section" id="add-catalog-indexes">
<h2>Add catalog-indexes<a class="headerlink" href="#add-catalog-indexes" title="Permalink to this headline">Â¶</a></h2>
<p>In the <cite>talklistview</cite> we had to wake up all objects to access some of their attributes. That is ok if we don&#8217;t have many objects and they are light dexterity-objects. If we had thousands of objects this might not be a good idea.</p>
<p>Instead of loading them all into memory we will use catalog-indexes to get the data we want to display.</p>
<p>Add a new file <tt class="docutils literal"><span class="pre">catalog.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;portal_catalog&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;type_of_talk&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;FieldIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;type_of_talk&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;speaker&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;FieldIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;speaker&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;audience&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;KeywordIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;audience&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>

  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;audience&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;type_of_talk&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;speaker&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This adds new indexes for the three fields we want to show in the listing. Not that <em>audience</em> is a <tt class="docutils literal"><span class="pre">KeywordIndex</span></tt> because the field is multi-valued, but we want a separate index-entry for every value in on an object.</p>
<p>The <tt class="docutils literal"><span class="pre">column</span> <span class="pre">..</span></tt> entry allows us to display these values of these indexes in the tableview of collections.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Until Plone 4.3.2 adding indexes in catalog.xml was harmful because reinstalling the addon purged the indexes! See <a class="reference external" href="http://www.starzel.de/blog/a-reminder-about-catalog-indexes">http://www.starzel.de/blog/a-reminder-about-catalog-indexes</a>.</p>
<p class="last">To run additional custom code on (re-)installing an addon you should use a <a class="reference external" href="http://docs.plone.org/develop/addons/components/genericsetup.html#custom-installer-code-setuphandlers-py">setuphandler.py</a>.</p>
</div>
<ul class="simple">
<li>Reinstall the addon</li>
<li>Go to <a class="reference external" href="http://localhost:8080/Plone/portal_catalog/manage_catalogIndexes">http://localhost:8080/Plone/portal_catalog/manage_catalogIndexes</a> to inspect populate and inspect the new indexes</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/searching_and_indexing/indexing.html">http://docs.plone.org/develop/plone/searching_and_indexing/indexing.html</a></p>
</div>
</div>
<div class="section" id="query-for-custom-indexes">
<h2>Query for custom indexes<a class="headerlink" href="#query-for-custom-indexes" title="Permalink to this headline">Â¶</a></h2>
<p>The new indexes behave like the ones that plone has built in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">Products.CMFCore.utils</span> <span class="kn">import</span> <span class="n">getToolByName</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span><span class="p">(</span><span class="n">type_of_talk</span><span class="o">=</span><span class="s">&#39;Keynote&#39;</span><span class="p">)</span>
<span class="go">[&lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span><span class="p">(</span><span class="n">audience</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Advanced&#39;</span><span class="p">,</span> <span class="s">&#39;Professionals&#39;</span><span class="p">))</span>
<span class="go">[&lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b870&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b940&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">type_of_talk</span><span class="o">=</span><span class="s">&#39;Keynote&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">brain</span><span class="o">.</span><span class="n">speaker</span>
<span class="go">u&#39;David Glick&#39;</span>
</pre></div>
</div>
<p>We now can use the new indexes to improve the talklistview so we don&#8217;t have to wake up the objects any more.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TalkListView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A list of talks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">talks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
        <span class="n">current_path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">())</span>

        <span class="n">brains</span> <span class="o">=</span> <span class="n">portal_catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&quot;talk&quot;</span><span class="p">,</span>
                                <span class="n">path</span><span class="o">=</span><span class="n">current_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span>
                <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Description</span><span class="p">,</span>
                <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">(),</span>
                <span class="s">&#39;audience&#39;</span><span class="p">:</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">brain</span><span class="o">.</span><span class="n">audience</span><span class="p">),</span>
                <span class="s">&#39;type_of_talk&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">type_of_talk</span><span class="p">,</span>
                <span class="s">&#39;speaker&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span>
                <span class="s">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">UID</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</td></tr></table></div>
<p>The template does not need to be changed and the result did not change as well.</p>
</div>
<div class="section" id="add-collection-criteria">
<h2>Add collection criteria<a class="headerlink" href="#add-collection-criteria" title="Permalink to this headline">Â¶</a></h2>
<p>To be able to search content in collection using the new indexes we would have to register them as criteria for the querystring-widget that collection use.</p>
<p>Add a new file <tt class="docutils literal"><span class="pre">profiles/default/registry.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;registry&gt;</span>
  <span class="nt">&lt;records</span> <span class="na">interface=</span><span class="s">&quot;plone.app.querystring.interfaces.IQueryField&quot;</span>
           <span class="na">prefix=</span><span class="s">&quot;plone.app.querystring.field.audience&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Audience<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>A custom speaker index<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;enabled&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;sortable&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;operations&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;element&gt;</span>plone.app.querystring.operation.string.is<span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;group&quot;</span><span class="nt">&gt;</span>Metadata<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/records&gt;</span>
  <span class="nt">&lt;records</span> <span class="na">interface=</span><span class="s">&quot;plone.app.querystring.interfaces.IQueryField&quot;</span>
           <span class="na">prefix=</span><span class="s">&quot;plone.app.querystring.field.type_of_talk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Type of Talk<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>A custom index<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;enabled&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;sortable&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;operations&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;element&gt;</span>plone.app.querystring.operation.string.is<span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;group&quot;</span><span class="nt">&gt;</span>Metadata<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/records&gt;</span>
<span class="nt">&lt;/registry&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/functionality/collections.html#add-new-collection-criteria-new-style-plone-app-collection-installed">http://docs.plone.org/develop/plone/functionality/collections.html#add-new-collection-criteria-new-style-plone-app-collection-installed</a></p>
</div>
</div>
<div class="section" id="add-more-features-through-generic-setup">
<h2>Add more features through generic-setup<a class="headerlink" href="#add-more-features-through-generic-setup" title="Permalink to this headline">Â¶</a></h2>
<p>Enable versioning and a diff-view for talks through GenericSetup.</p>
<p>Add new file <tt class="docutils literal"><span class="pre">profiles/default/repositorytool.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;repositorytool&gt;</span>
  <span class="nt">&lt;policymap&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;talk&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;policy</span> <span class="na">name=</span><span class="s">&quot;at_edit_autoversion&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;policy</span> <span class="na">name=</span><span class="s">&quot;version_on_revert&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/policymap&gt;</span>
<span class="nt">&lt;/repositorytool&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Add new file <tt class="docutils literal"><span class="pre">profiles/default/diff_tool.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object&gt;</span>
  <span class="nt">&lt;difftypes&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">portal_type=</span><span class="s">&quot;talk&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;any&quot;</span> <span class="na">difftype=</span><span class="s">&quot;Compound Diff for Dexterity types&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/difftypes&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="custom_search.html" class="btn btn-neutral float-right" title="24. Custom search"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ide.html" class="btn btn-neutral" title="22. IDEâ€™s and Editors"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Philip Bauer, Patrick Gerken. Version 1.2.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>